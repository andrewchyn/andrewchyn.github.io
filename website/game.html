<!doctype html>
<html>
<head>
    <title>test</title>
</head>
<body>
 
<canvas id ="canvas" style="border:1px solid #000"> 
</canvas>

<script>

	(function() {
	var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
	    window.requestAnimationFrame = requestAnimationFrame;
	})();

	var canvas = document.getElementById("canvas"),
	    ctx = canvas.getContext("2d"),
	    width = window.innerWidth-20,
	    height = window.innerHeight-300,
	    player = {
	      x : width/2,
	      y : height - 30,
	      width : 30,
	      height : 30,
	      speed: 3,
	      velX: 0,
	      velY: 0,
	      jumping: false,
	      forward: 1,
	      dashState: "red"
	    },
	    keys = [],
	    friction = 0.5,
	    gravity = 0.9;
	    dash = 8
	    inc = 3
	 
	//canvas.style = "position:absolute; left: 50%; width: 400px; margin-left: -200px;";
	canvas.width = width;
	canvas.height = height;
	ctx.font = "30px Arial";
	 
	function update(){
		player.dashState = "red"
	  // check keys

	  	if (player.dashState == "red") {
	  	//right dashes
		 	if (keys[82] && keys[39]) { //right                
		        player.x += dash
		        player.dashState = "cyan"
		    }
		    if (keys[82] && keys[39] && keys[38]) { //upright             
		        player.x += Math.sqrt(dash)
		        player.y -= dash
		        player.dashState = "cyan"
		    }
		    if (keys[82] && keys[39] && keys[40]) { //downright                 
		        player.x += Math.sqrt(dash)
		        player.y += dash
		        player.dashState = "cyan"
		    }

		    //left dashes
		   	if (keys[82] && keys[37]) { //left              
		        player.x -= dash
		        player.dashState = "cyan"
		    }
		    if (keys[82] && keys[37] && keys[38]) { //upleft            
		        player.x -= Math.sqrt(dash)
		        player.y -= dash
		        player.dashState = "cyan"
		    }
		    if (keys[82] && keys[37] && keys[40]) { //downleft                
		        player.x -= Math.sqrt(dash)
		        player.y += dash
		        player.dashState = "cyan"
		    }

		    //neutral dash
		    if (keys[82]) {
		    	if(player.forward == 1){
		    		player.x += dash
		    	}
		    	else {
		    		player.x -= dash
		    	}
		    	player.dashState = "cyan"
	        }
		}

	    //jump
	    if (keys[38] || keys[32]) {
	        // up arrow or space
	      if(!player.jumping){
	       player.jumping = true;
	       player.velY = -player.speed*3;
	      }
	    }

	    if (keys[39]) {
	        // right arrow
	        if (player.velX < player.speed) {             
	            player.velX += inc;         
	         }     
	         player.forward = 1
	    }     

	    if (keys[37]) {         
	        // left arrow         
	        if (player.velX > -player.speed) {
	            player.velX -= inc;
	        }
	        player.forward = 0
	    }
	 
	    player.velX *= friction;
	 
	    player.velY += gravity;
	 
	    player.x += player.velX;
	    player.y += player.velY;
	 
	    if (player.x >= width-player.width) {
	        player.x = width-player.width;
	    } else if (player.x <= 0) {         
	        player.x = 0;     
	    }    
	  
	    if(player.y >= height-player.height){
	        player.y = height - player.height;
	        player.jumping = false;
	    }


	    //end of update
	  ctx.fillText(player.dashState, 300, 500);
	  ctx.clearRect(0,0,width,height);
	  ctx.fillStyle = player.dashState;
	  ctx.fillRect(player.x, player.y, player.width, player.height);
	 
	  requestAnimationFrame(update);
	}
	 
	document.body.addEventListener("keydown", function(e) {
	    keys[e.keyCode] = true;
	});
	 
	document.body.addEventListener("keyup", function(e) {
	    keys[e.keyCode] = false;
	});
	 
	window.addEventListener("load",function(){
	    update();
	});


</script>
</body>
</html>